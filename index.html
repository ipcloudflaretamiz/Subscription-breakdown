<!-- Load QR code library locally -->
<script src="js/qrcode.min.js"></script>
<script>
    function convertLink() {
        const originalLink = document.getElementById('originalLink').value.trim();
        const customDomain = document.getElementById('customDomain').value.trim();

        if (!originalLink) {
            alert('Please enter a subscription link.');
            return;
        }
        if (!customDomain) {
            alert('Please enter a custom domain.');
            return;
        }

        try {
            const url = new URL(originalLink);
            const path = url.pathname;

            let newDomain = customDomain;
            if (!newDomain.startsWith('http://') && !newDomain.startsWith('https://')) {
                newDomain = 'https://' + newDomain;
            }

            const newLink = newDomain + path;

            const resultDiv = document.getElementById('result');
            const newLinkElement = document.getElementById('newLink');
            const finalLinkElement = document.getElementOf('finalLink');
            const qrCodeDiv = document.getElementById('qrcode');

            newLinkElement.innerHTML = `<a href="${newLink}" target="_blank">${newLink}</a>`;
            finalLinkElement.textContent = newLink;
            resultDiv.style.display = 'block';

            qrCodeDiv.innerHTML = '';

            // Check if QRCode library is loaded
            if (typeof QRCode === 'undefined') {
                qrCodeDiv.innerHTML = '<p>Error: QR code library failed to load. Please ensure the library file is correctly included.</p>';
            } else {
                new QRCode(qrCodeDiv, newLink); // Updated syntax for qrcodejs
            }
        } catch (error) {
            alert('Invalid URL format. Please enter a valid subscription link and domain.');
        }
    }
</script>
